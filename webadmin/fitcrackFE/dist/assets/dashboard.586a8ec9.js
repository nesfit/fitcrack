import{n as r}from"./index.da48d82d.js";import{j as v}from"./iconMaps.853c93a3.js";import{m as u}from"./miniJob.de904b94.js";import{D as d,m as _,c as m}from"./timeseries.9158092b.js";import{j as h}from"./jobProgress.a3ffa52e.js";import{w as p}from"./jobWorkunits.a15ba372.js";import{D as f}from"./datetime.524c0c5c.js";import"./vendor.6aa46313.js";var b=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"host-grid"},[t._l(t.active,function(a){return s("v-sheet",{key:"ha"+a,staticClass:"host-icon host-online rounded-xl",attrs:{rounded:"",color:"success"}})}),t._l(t.inactive,function(a){return s("v-sheet",{key:"hi"+a,staticClass:"host-icon host-offline rounded-xl",attrs:{rounded:""}})})],2)},g=[];const C={props:{active:{type:Number,default:0},inactive:{type:Number,default:0}}},i={};var y=r(C,b,g,!1,x,"78bf414a",null,null);function x(t){for(let e in i)this[e]=i[e]}var j=function(){return y.exports}(),$=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"dashboard-status"},[s("div",{staticClass:"py-4 px-8 top-panel d-flex justify-space-between align-center"},[s("div",[s("h1",[t._v("Hello, "+t._s(t.$store.state.user.userData.username)+"!")]),s("h2",[t._v(" There "+t._s(t.pluralJobs?"are":"is")+" currently "+t._s(t.activeJobs)+" active job"+t._s(t.pluralJobs?"s":"")+" with "+t._s(t.hosts.activeHosts)+" host"+t._s(t.pluralHosts?"s":"")+" connected. ")])]),s("div",{staticClass:"shortcuts"},[s("v-btn",{staticClass:"mr-2",attrs:{large:"",text:"",to:{name:"hashes"}}},[s("v-icon",{attrs:{left:""}},[t._v(" mdi-book-lock ")]),s("span",[t._v("Hashes")])],1),s("v-btn",{attrs:{large:"",color:"primary",elevation:"0",to:{name:"addJob"}}},[s("v-icon",{attrs:{left:""}},[t._v(" mdi-briefcase-plus ")]),s("span",[t._v("New job")])],1)],1)]),s("v-divider"),s("div",{staticClass:"d-flex flex-wrap"},[s("div",{staticClass:"status-tile jobs"},[s("v-card-title",{staticClass:"py-0"},[t._v(" Jobs ")]),s("div",{staticClass:"jobs-wrapper"},t._l(t.jobs,function(a){return s("div",{key:a.status,staticClass:"job-tile"},[s("v-icon",{attrs:{left:"",color:t.jobColor(a.status)}},[t._v(" "+t._s(t.jobIcon(a.status))+" ")]),s("span",[s("strong",[t._v(t._s(a.count))]),t._v(" "+t._s(a.status))])],1)}),0)],1),s("div",{staticClass:"status-tile hosts"},[s("v-card-title",{staticClass:"py-0"},[t._v(" Hosts ")]),s("div",{staticClass:"host-summary mx-4"},[s("span",{staticClass:"mono"},[t._v(t._s(t.hosts.activeHosts))]),t._v(" of "),s("span",{staticClass:"mono"},[t._v(t._s(t.hosts.totalHosts))]),t._v(" online ")]),s("host-grid",{staticClass:"ma-3",attrs:{active:t.hosts.activeHosts,inactive:t.hosts.inactiveHosts}})],1),s("div",{staticClass:"status-tile server"},[s("v-card-title",{staticClass:"py-0 d-flex justify-space-between"},[t._v(" Server "),s("v-btn",{attrs:{"x-small":"",color:"info",elevation:"0",to:{name:"server"}}},[s("v-icon",{attrs:{small:"",left:""}},[t._v(" mdi-chart-multiline ")]),s("span",[t._v("Monitor")])],1)],1),s("div",{staticClass:"server-wrapper"},[t._t("default")],2)],1)])],1)},w=[];const k={components:{hostGrid:j},props:{jobs:{type:Array,default:()=>[]},hosts:{type:Object,default:()=>{}},server:{type:Array,default:()=>[]}},computed:{activeJobs(){return this.jobs.filter(t=>t.status==="running"||t.status==="finishing").reduce((t,e)=>t+=e.count,0)},pluralJobs(){return this.activeJobs!==1},pluralHosts(){return this.hosts.activeHosts!==1}},methods:{jobIcon:v,jobColor(t){return{ready:"info",finished:"success",exhausted:"error",malformed:"error",finishing:"info"}[t]}}},o={};var D=r(k,$,w,!1,I,"5bd53039",null,null);function I(t){for(let e in o)this[e]=o[e]}var S=function(){return D.exports}(),H={extends:d,mixins:[_.reactiveProp],props:{overrides:{type:Object,default:null}},computed:{options(){return m({maintainAspectRatio:!1,plugins:{tooltip:{enabled:!1}},hover:{mode:null},animation:{animateScale:!0},cutout:"65%",rotation:-135,circumference:270},this.overrides)}},mounted(){this.renderChart(this.chartData,this.options)}},J=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"gauge-container"},[s("div",{staticClass:"gauge-inner-wrapper"},[s("gauge",{staticClass:"gauge",style:{maxHeight:t.size+"px",maxWidth:t.size+"px"},attrs:{"chart-data":t.chartdata,overrides:t.options}}),s("div",{staticClass:"gauge-value"},[t._v(" "+t._s(t.valueFormat(t.value))+" ")])],1),s("div",{staticClass:"gauge-label"},[t._t("default")],2)])},F=[];const N={components:{Gauge:H},props:{min:{type:Number,default:0},max:{type:Number,default:100},value:{type:Number,default:50},color:{type:String,default:void 0},size:{type:[String,Number],default:128},valueFormat:{type:Function,default:t=>t}},data:()=>({options:{plugins:{legend:{display:!1}}}}),computed:{fillColor(){return this.color||this.$vuetify.theme.currentTheme.primary},chartdata(){const t=this.max-this.min,e=this.value,s=t-e;return{datasets:[{backgroundColor:[this.fillColor,"#9994"],borderWidth:0,data:[e,s]}]}}}},n={};var M=r(N,J,F,!1,T,"143f20ce",null,null);function T(t){for(let e in n)this[e]=n[e]}var A=function(){return M.exports}(),P=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"server-gauges-container"},[s("gauge",{staticClass:"mr-8",attrs:{value:t.cpu,"value-format":function(a){return(a||"--")+"%"},color:t.gaugeColor(t.cpu)}},[s("div",{staticClass:"d-flex flex-column g-label-wrapper"},[s("v-icon",{staticClass:"mb-1"},[t._v(" mdi-memory ")]),s("span",{staticClass:"overline g-label-text"},[t._v("CPU")])],1)]),s("gauge",{staticClass:"mr-10",attrs:{value:t.ram,"value-format":function(a){return(a||"--")+"%"},color:t.gaugeColor(t.ram)}},[s("div",{staticClass:"d-flex flex-column g-label-wrapper"},[s("v-icon",{staticClass:"mb-1"},[t._v(" mdi-chip ")]),s("span",{staticClass:"overline g-label-text"},[t._v("Memory")])],1)]),s("div",{staticClass:"text-module disk-usage my-2 mr-10"},[s("div",{staticClass:"stat-label mb-1"},[s("v-icon",[t._v("mdi-harddisk")]),s("span",{staticClass:"overline g-label-text"},[t._v("Disk")])],1),s("div",{staticClass:"stat"},[s("v-icon",{attrs:{left:"",small:""}},[t._v(" mdi-arrow-top-right ")]),s("span",{staticClass:"overline"},[t._v("read")]),s("div",{staticClass:"stat-value"},[t._v(" "+t._s(t.hdd_read||"--")),s("span",{staticClass:"stat-unit"},[t._v(" kb/s")])])],1),s("div",{staticClass:"stat"},[s("v-icon",{attrs:{left:"",small:""}},[t._v(" mdi-arrow-bottom-left ")]),s("span",{staticClass:"overline"},[t._v("write")]),s("div",{staticClass:"stat-value"},[t._v(" "+t._s(t.hdd_write||"--")),s("span",{staticClass:"stat-unit"},[t._v(" kb/s")])])],1)]),s("div",{staticClass:"text-module net-usage my-2 mr-10"},[s("div",{staticClass:"stat-label mb-1"},[s("v-icon",[t._v("mdi-ethernet")]),s("span",{staticClass:"overline g-label-text"},[t._v("Network")])],1),s("div",{staticClass:"stat"},[s("v-icon",{attrs:{left:"",small:""}},[t._v(" mdi-arrow-bottom-left ")]),s("span",{staticClass:"overline"},[t._v("download")]),s("div",{staticClass:"stat-value"},[t._v(" "+t._s(t.net_recv||"--")),s("span",{staticClass:"stat-unit"},[t._v(" kb/s")])])],1),s("div",{staticClass:"stat"},[s("v-icon",{attrs:{left:"",small:""}},[t._v(" mdi-arrow-top-right ")]),s("span",{staticClass:"overline"},[t._v("upload")]),s("div",{staticClass:"stat-value"},[t._v(" "+t._s(t.net_sent||"--")),s("span",{staticClass:"stat-unit"},[t._v(" kb/s")])])],1)]),s("div",{staticClass:"text-module services my-2"},[s("div",{staticClass:"stat-label mb-1"},[s("v-icon",[t._v("mdi-toolbox-outline")]),s("span",{staticClass:"overline g-label-text"},[t._v("Services")])],1),t.failedServices.length>0?s("v-sheet",{staticClass:"highlighted-stat px-2 pb-1 mb-1",attrs:{rounded:"",color:"error",dark:""}},[s("v-icon",{attrs:{left:"",small:""}},[t._v(" mdi-heart-broken ")]),s("span",{staticClass:"overline"},[t._v("Down")]),s("ul",{staticClass:"font-weight-bold"},t._l(t.failedServices,function(a){return s("li",{key:a},[t._v(" "+t._s(a)+" ")])}),0)],1):t._e(),s("div",{staticClass:"stat"},[s("v-icon",{attrs:{left:"",small:""}},[t._v(" mdi-heart ")]),s("span",{staticClass:"overline"},[t._v("running")]),t.failedServices.length==0?s("div",{staticClass:"stat-value"},[t._v(" All good ")]):s("div",{staticClass:"stat-value"},[t._v(" "+t._s(t.runningServices.length||"--")),s("span",{staticClass:"stat-unit"},[t._v(" daemons OK")])])],1)],1)],1)},G=[];const Y={components:{Gauge:A},props:{cpu:{type:Number,default:0},ram:{type:Number,default:0},hdd_read:{type:Number,default:0},hdd_write:{type:Number,default:0},net_recv:{type:Number,default:0},net_sent:{type:Number,default:0},services:{type:Array,default:()=>[]}},computed:{runningServices(){return this.services.filter(t=>t.status==="running").map(t=>t.name)},failedServices(){return this.services.filter(t=>t.status!=="running").map(t=>t.name)}},methods:{gaugeColor(t){const e=this.$vuetify.theme.currentTheme;return t<50?e.success:t<80?e.warning:e.error}}},l={};var R=r(Y,P,G,!1,E,"32057e3e",null,null);function E(t){for(let e in l)this[e]=l[e]}var U=function(){return R.exports}(),W=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"dash-container"},[s("v-sheet",{staticClass:"dash-row pa-0"},[t.hostsInfo?s("status",{attrs:{jobs:t.jobsInfo,hosts:t.hostsInfo,server:t.serverInfo}},[s("server-gauges",t._b({attrs:{services:t.serverInfo}},"server-gauges",t.actualUsage,!1))],1):t._e()],1),s("v-divider"),s("v-card-title",{staticClass:"px-8"},[t._v(" Last jobs ")]),t.lastJobs?s("div",{staticClass:"minijobs overflowing dash-row pt-0 pb-7 px-8"},[s("minijob",{attrs:{detailed:"",data:t.lastJobs[0]}}),t._l(t.lastJobs.slice(1),function(a){return s("minijob",{key:a.id,attrs:{data:a}})}),s("div",{staticClass:"pr-6"},[s("v-btn",{attrs:{to:"/jobs",large:"",color:"primary"}},[t._v(" See all "),s("v-icon",{attrs:{right:""}},[t._v(" mdi-briefcase-search ")])],1)],1)],2):t._e(),s("v-divider"),s("v-sheet",{staticClass:"dash-row px-4"},[s("div",{staticClass:"half"},[s("v-card-title",[t._v("Progress of all jobs")]),s("jobProgress",{attrs:{from:t.chartsFrom,to:t.chartsTo}})],1),s("div",{staticClass:"half"},[s("v-card-title",[t._v("Global workunits distribution")]),s("jobWorkunits",{attrs:{logarithmic:"",from:t.chartsFrom,to:t.chartsTo}})],1)]),s("v-sheet",{staticClass:"dash-row px-8 justify-end"},[s("div",{staticClass:"d-flex"},[s("dt-picker",{staticClass:"mr-4",attrs:{label:"From"},model:{value:t.chartsFrom,callback:function(a){t.chartsFrom=a},expression:"chartsFrom"}}),s("dt-picker",{attrs:{label:"To"},model:{value:t.chartsTo,callback:function(a){t.chartsTo=a},expression:"chartsTo"}})],1)])],1)},z=[];const O={name:"Dashboard",components:{status:S,minijob:u,serverGauges:U,jobProgress:h,jobWorkunits:p,dtPicker:f},data(){return{chartsFrom:this.$moment().subtract(24,"hours").format("YYYY-MM-DDTHH:mm"),chartsTo:this.$moment().format("YYYY-MM-DDTHH:mm"),hostsInfo:null,jobsInfo:[],serverInfo:[],lastJobs:null,actualUsage:{cpu:0,ram:0,hdd_read:0,hdd_write:0,net_recv:0,net_sent:0}}},mounted(){this.loadData(),this.interval=setInterval(this.loadData,5e3)},beforeDestroy(){clearInterval(this.interval)},methods:{loadData(){this.axios.get(this.$serverAddr+"/job/lastJobs").then(t=>{this.lastJobs=t.data.items}),this.axios.get(this.$serverAddr+"/serverInfo/actualUsageData").then(t=>{this.actualUsage=t.data}),this.axios.get(this.$serverAddr+"/hosts/info").then(t=>{this.hostsInfo=t.data}),this.axios.get(this.$serverAddr+"/job/info").then(t=>{this.jobsInfo=t.data}),this.axios.get(this.$serverAddr+"/serverInfo/info").then(t=>{this.serverInfo=t.data.subsystems})}}},c={};var K=r(O,W,z,!1,L,"9435004c",null,null);function L(t){for(let e in c)this[e]=c[e]}var et=function(){return K.exports}();export{et as default};
